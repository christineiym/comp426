---
title: "w11 Client-side scripting"
description: "This week we will discuss getting and sending information between a browser-based client to and an API. We will also learn how to set up a login session."
draft: false
weight: 110
enableToc: true
tocLevels: ["h2", "h3", "h4"]
---

## Fetch

`2022-03-29T15:30:00-05:00`

### Agenda

1. Revisit button click
2. Add a result field
3. Add an image
4. Make an API call with `fetch()`
5. Use the response from `fetch()` to manipulate elements.

### Slides

https://comp426-2022-spring.github.io/slides/w11-00.html

### Useful links

[HTML DOM Element setAttribute()](https://www.w3schools.com/jsref/met_element_setattribute.asp) - w3schools

[Use Express to deliver HTML files](https://www.digitalocean.com/community/tutorials/use-expressjs-to-deliver-html-files) - Chris Sev

[Promises](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise) - MDN

#### Buttons and Forms

[HTML DOM Button Object](https://www.w3schools.com/jsref/dom_obj_pushbutton.asp)

[HTML DOM Form Object](https://www.w3schools.com/jsref/dom_obj_form.asp)

#### fetch

[Introduction to fetch()](https://developers.google.com/web/updates/2015/03/introduction-to-fetch) - Matt Gaunt

[How to Use the JavaScript Fetch API to Perform HTTP Requests](https://cheatcode.co/tutorials/how-to-use-the-javascript-fetch-api-to-perform-http-requests#using-the-fetch-api-in-the-browser) - Ryan Glover

[fetch()](https://developer.mozilla.org/en-US/docs/Web/API/fetch) - MDN

[Using the Fetch API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch) - MDN

[How to use Fetch with async/await](https://dmitripavlutin.com/javascript-fetch-async-await/) - Dmitri Pavlutin

## Notes

Below is the coin flip interface that we put together in class.

You can serve this page using `browser-sync -sw`, if you have placed it in a node package with browsersync installed in it.
It will serve on port 3000.

```index.html
<html>
	<head>
		<title>Demo Coin</title>
		<style>
			img#quarter {
				width: 100px;
			}
		</style>
	</head>
	<body>
		
<!-- A "coin" button -->
		<button id="coin">Flip?</button>
<!-- A status paragraph -->
		<p id="active"></p>
<!-- A result paragraph-->
		<p>Result: <span id="result"></span></p>
<!-- An image of a US quarter (North Carolina variant) -->
		<img src="coin.jpg" id="quarter">

		<script>
// Event listener for whatever is being clicked 
//			document.addEventListener("click", activeNow);
// Replace text in anything with "active" id
			// function activeNow() {
			// 	const active_now = document.activeElement
			// 	document.getElementById("active").innerHTML = active_now;
			// 	console.log(active_now)
			// }
// Button coin flip element
			const coin = document.getElementById("coin")
// Add event listener for coin button
			coin.addEventListener("click", flipCoin)
			function flipCoin() {
                fetch('http://localhost:5000/app/flip/', {mode: 'cors'})
  				.then(function(response) {
    			  return response.json();
  				})
				.then(function(result) {
					console.log(result);
					document.getElementById("result").innerHTML = result.flip;
					document.getElementById("quarter").setAttribute("src", result.flip+".jpg");
					coin.disabled = true
				})
//				let flip = "FLIPPED"
//				document.getElementById("coin").innerHTML = flip;
//				console.log("Coin has been flipped. Result: "+ flip)
			}
		</script>
	</body>
</html>
```

You will need to enable Cross-Origin Resource Sharing (CORS) server-side since your server will be listening on a different port (5000). 

To do this, run `npm install cors` in your server package repository.

Then add the following to your `server.js`:

```server.js
// Add cors dependency
const cors = require('cors')
// Set up cors middleware on all endpoints
app.use(cors())
```

Here are the coin images that I used:

![coin](https://user-images.githubusercontent.com/2459227/160978577-c4f17a0f-dac0-463c-ab3b-0985c54b7dc4.jpg =100x)
![tails](https://user-images.githubusercontent.com/2459227/160978578-c55fcecf-73fd-4043-a1c7-51298fe18d5e.jpg =100x)
![heads](https://user-images.githubusercontent.com/2459227/160978580-dbc1cb25-0369-4161-b8fc-036dfbcbacc1.jpg =100x)

## Login session

`2022-03-31T15:30:00-05:00`


